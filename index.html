<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIVE Token | High-Yield Staking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #f97316; --bg: #0b0f1a; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: var(--bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(249, 115, 22, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(30, 58, 138, 0.2) 0px, transparent 50%);
            color: white;
            min-height: 100vh;
        }
        .glass-card {
            background: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(249, 115, 22, 0.4); }
        .stats-grid div { background: rgba(255, 255, 255, 0.03); border-radius: 16px; padding: 16px; border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="flex flex-col items-center justify-center p-6">

    <header class="text-center mb-10">
        <div class="inline-block p-1 rounded-full bg-gradient-to-tr from-orange-500 to-blue-500 mb-4">
            <img src="token-icon-3d-1.jpg" alt="Logo" class="w-20 h-20 rounded-full border-4 border-[#0b0f1a]">
        </div>
        <h1 class="text-3xl font-extrabold tracking-tight">LIVE <span class="text-orange-500">STAKING</span></h1>
        <div id="walletDisplay" class="text-xs text-slate-500 mt-2 font-mono bg-slate-900/50 px-3 py-1 rounded-full border border-white/5 hidden"></div>
    </header>

    <main class="w-full max-w-[480px]">
        <div class="glass-card p-8 shadow-2xl">
            <div id="loggedOutView" class="text-center py-4">
                <p class="text-slate-400 mb-8 text-sm">Securely stake your LIVE tokens and earn passive income with 100% APY.</p>
                <button onclick="init()" class="btn-primary w-full py-4 rounded-2xl font-bold text-lg">Connect Wallet</button>
            </div>

            <div id="loggedInView" class="hidden space-y-6">
                <div class="stats-grid grid grid-cols-2 gap-4">
                    <div>
                        <p class="text-[10px] uppercase tracking-widest text-slate-500 mb-1">Your Staked</p>
                        <p class="text-xl font-bold text-white" id="stakedBal">0.00</p>
                    </div>
                    <div>
                        <p class="text-[10px] uppercase tracking-widest text-slate-500 mb-1">Rewards</p>
                        <p class="text-xl font-bold text-green-400" id="rewardBal">0.00</p>
                    </div>
                </div>

                <div class="relative group">
                    <input type="number" id="amount" placeholder="0.0" 
                        class="w-full bg-black/40 border border-white/10 rounded-2xl px-5 py-6 text-2xl font-bold focus:outline-none focus:border-orange-500/50 transition-all">
                    <span class="absolute right-5 top-1/2 -translate-y-1/2 font-bold text-slate-500">LIVE</span>
                </div>

                <div class="flex gap-3">
                    <button onclick="actionStake()" class="btn-primary flex-1 py-4 rounded-xl font-bold uppercase tracking-wider text-sm">Stake</button>
                    <button onclick="actionUnstake()" class="bg-white/5 hover:bg-white/10 border border-white/10 flex-1 py-4 rounded-xl font-bold uppercase tracking-wider text-sm transition-all">Unstake</button>
                </div>

                <button onclick="actionClaim()" class="w-full py-4 rounded-xl font-bold text-orange-500 border border-orange-500/20 hover:bg-orange-500/5 transition-all uppercase tracking-widest text-xs">
                    Claim Rewards Only
                </button>
                
                <div class="pt-4 border-t border-white/5">
                    <div class="flex justify-between text-[11px] text-slate-500 uppercase tracking-widest">
                        <span>Total Value Locked</span>
                        <span id="tvlDisplay" class="text-slate-300">Loading...</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-10 text-slate-600 text-[10px] uppercase tracking-[0.2em]">
        &copy; 2026 LiveToken Ecosystem
    </footer>

    <script>
        const ADDR = {
            TOKEN: "0xd1119110bbC86EbC0479A2B45F1796Ff9f416cBf",
            STAKING: "0xbfB68377f62a3Fe6feFAb1e08cD1FAD0EdBca17B"
        };

        const MIN_ABI = [
            "function stake(uint256 amount) external",
            "function unstake(uint256 amount) external",
            "function claimRewards() public",
            "function calculateRewards(address user) public view returns (uint256)",
            "function getStakedAmount(address user) external view returns (uint256)",
            "function getTVL() external view returns (uint256)",
            "function approve(address spender, uint256 amount) external returns (bool)"
        ];

        let signer, staking, token, user;

        async function init() {
            if (!window.ethereum) return alert("MetaMask required");
            const p = new ethers.BrowserProvider(window.ethereum);
            signer = await p.getSigner();
            user = await signer.getAddress();
            
            staking = new ethers.Contract(ADDR.STAKING, MIN_ABI, signer);
            token = new ethers.Contract(ADDR.TOKEN, MIN_ABI, signer);

            document.getElementById('loggedOutView').classList.add('hidden');
            document.getElementById('loggedInView').classList.remove('hidden');
            document.getElementById('walletDisplay').classList.remove('hidden');
            document.getElementById('walletDisplay').innerText = user;
            
            refresh();
            setInterval(refresh, 10000);
        }

        async function refresh() {
            try {
                const [s, r, t] = await Promise.all([
                    staking.getStakedAmount(user),
                    staking.calculateRewards(user),
                    staking.getTVL()
                ]);
                document.getElementById('stakedBal').innerText = parseFloat(ethers.formatUnits(s, 18)).toFixed(2);
                document.getElementById('rewardBal').innerText = parseFloat(ethers.formatUnits(r, 18)).toFixed(4);
                document.getElementById('tvlDisplay').innerText = parseFloat(ethers.formatUnits(t, 18)).toFixed(0) + " LIVE";
            } catch (e) { console.error("Sync error", e); }
        }

        async function actionStake() {
            const amt = document.getElementById('amount').value;
            if(!amt) return;
            const wei = ethers.parseUnits(amt, 18);
            try {
                const tx1 = await token.approve(ADDR.STAKING, wei);
                await tx1.wait();
                const tx2 = await staking.stake(wei);
                await tx2.wait();
                refresh();
            } catch (e) { alert("Error: " + e.code); }
        }

        async function actionUnstake() {
            const amt = document.getElementById('amount').value;
            if(!amt) return;
            try {
                const tx = await staking.unstake(ethers.parseUnits(amt, 18));
                await tx.wait();
                refresh();
            } catch (e) { alert("Error"); }
        }

        async function actionClaim() {
            try {
                const tx = await staking.claimRewards();
                await tx.wait();
                refresh();
            } catch (e) { alert("Error"); }
        }
    </script>
</body>
</html>
