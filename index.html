<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIVE Token Staking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: white; }
        .card { background: #1e293b; border: 1px solid #334155; border-radius: 1rem; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full space-y-6">
        <div class="text-center">
            <h1 class="text-4xl font-bold text-orange-500">LIVE STAKING</h1>
            <p class="text-slate-400 mt-2">Zarabiaj 100% APY w tokenach LIVE</p>
        </div>

        <div class="card p-6 shadow-2xl">
            <div id="connectSection">
                <button onclick="connect()" class="w-full bg-orange-500 hover:bg-orange-600 py-4 rounded-xl font-bold transition-all">Połącz Portfel</button>
            </div>

            <div id="stakingSection" class="hidden space-y-4">
                <div class="grid grid-cols-2 gap-4 text-center mb-6">
                    <div class="bg-slate-900 p-3 rounded-lg">
                        <div class="text-xs text-slate-500">STAKOWANE</div>
                        <div id="stakedAmount" class="text-lg font-bold">0.00</div>
                    </div>
                    <div class="bg-slate-900 p-3 rounded-lg">
                        <div class="text-xs text-slate-500">NAGRODY</div>
                        <div id="rewardsAmount" class="text-lg font-bold text-green-400">0.00</div>
                    </div>
                </div>

                <input type="number" id="amountInput" placeholder="Ilość LIVE" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg focus:outline-none focus:border-orange-500">
                
                <div class="flex gap-2">
                    <button onclick="handleStake()" class="flex-1 bg-green-600 hover:bg-green-700 py-3 rounded-lg font-bold">STAKE</button>
                    <button onclick="handleUnstake()" class="flex-1 bg-red-600 hover:bg-red-700 py-3 rounded-lg font-bold">UNSTAKE</button>
                </div>

                <button onclick="handleClaim()" class="w-full bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold mt-2">ODBIERZ NAGRODY</button>
                
                <p id="statusMsg" class="text-center text-sm text-slate-500 mt-4"></p>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            TOKEN: "0xd1119110bbC86EbC0479A2B45F1796Ff9f416cBf",
            STAKING: "0xbfB68377f62a3Fe6feFAb1e08cD1FAD0EdBca17B"
        };

        const ABI = [
            "function stake(uint256 amount) external",
            "function unstake(uint256 amount) external",
            "function claimRewards() public",
            "function calculateRewards(address user) public view returns (uint256)",
            "function getStakedAmount(address user) external view returns (uint256)",
            "function approve(address spender, uint256 amount) external returns (bool)"
        ];

        let signer, staking, token;

        async function connect() {
            if (!window.ethereum) return alert("Zainstaluj MetaMask!");
            const provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            staking = new ethers.Contract(CONFIG.STAKING, ABI, signer);
            token = new ethers.Contract(CONFIG.TOKEN, ABI, signer);
            
            document.getElementById('connectSection').classList.add('hidden');
            document.getElementById('stakingSection').classList.remove('hidden');
            refreshData();
        }

        async function refreshData() {
            const addr = await signer.getAddress();
            const staked = await staking.getStakedAmount(addr);
            const rewards = await staking.calculateRewards(addr);
            document.getElementById('stakedAmount').innerText = ethers.formatUnits(staked, 18);
            document.getElementById('rewardsAmount').innerText = ethers.formatUnits(rewards, 18);
        }

        async function handleStake() {
            const val = document.getElementById('amountInput').value;
            if (!val) return;
            const amount = ethers.parseUnits(val, 18);
            document.getElementById('statusMsg').innerText = "Zatwierdzanie tokenów...";
            await (await token.approve(CONFIG.STAKING, amount)).wait();
            document.getElementById('statusMsg').innerText = "Stakowanie...";
            await (await staking.stake(amount)).wait();
            document.getElementById('statusMsg').innerText = "Gotowe!";
            refreshData();
        }

        async function handleUnstake() {
            const val = document.getElementById('amountInput').value;
            const amount = ethers.parseUnits(val, 18);
            await (await staking.unstake(amount)).wait();
            refreshData();
        }

        async function handleClaim() {
            await (await staking.claimRewards()).wait();
            refreshData();
        }
    </script>
</body>
</html>
